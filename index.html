<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>TiltDJ</title>

    <!-- zimjs.com - JavaScript Canvas Framework -->
    <script type="module">
      import zim from "https://zimjs.org/cdn/016/zim";
      // See Docs under Frame for FIT, FILL, FULL, and TAG
      new Frame({
        scaling: FIT,
        width: 1500,
        height: 2896,
        color: dark,
        outerColor: dark,
        ready: ready,
        assets: ["1.mp3", "2.mp3", "3.mp3"],
        path: "assets/",
        sensors: true,
      });
      function ready() {
        const bg = new Pic("bg.png").alp(0.6).center();
        const audio1 = new Aud("1.mp3");
        const audio2 = new Aud("2.mp3");
        //make soundwave listen to audio3
        const audio4 = new Aud("4.mp3");
        const audio5 = new Aud("5.mp3");
        const audio6 = new Aud("6.mp3");
        const audio7 = new Aud("7.mp3");
        const riser = new Aud("riser.mp3");

        const scope = new Container(1290, 2896).pos(0, 0, CENTER);
        const synth = new Synth();
        
        const ball1 = new Circle(20, "#f5776e").center();
        const ball2 = new Circle(20, "#89defa").center();

        const permissionType1 = "deviceorientation";
        const permissionType2 = "devicemotion";

        const ask = new PermissionAsk(init, permissionType1, permissionType2);

        function init(yes) {
          const errorPane = new Pane("SENSOR not available", yellow);
          if (yes) {
            const label1 = new Label().center();
            const a1 = audio1.play();
            const a2 = audio2.play();
            const a3 = audio4.play();
            const s1 = audio5.play();
            const s2 = audio6.play();
            const s3 = audio7.play();

            F.on("deviceorientation", (e) => {
              ball1.loc(W / 2 + e.rotation.y * 10, H / 2);

              if (ball1.x > W / 2) {
                a1.volume = 0.1;
                a2.volume = 0;
                a3.volume = 0;
              } else if (ball1.x > 600 && ball1.x < 700) {
                a3.volume = 0.1;
                a1.volume = 0;
                a2.volume = 0;
              } else {
                a1.volume = 0;
                a2.volume = 0.1;
                a3.volume = 0;
              }
              S.update();
            });

            F.on("deviceorientation", (e) => {

              label1.text = decimals(e.rotation.x, 2);

              ball2.loc(
                W / 2 + e.rotation.x * 10,
                H / 2 + e.rotation.y * 10
              );

              if (ball2.y > 500) {
                s1.volume = 0.1;
                s2.volume = 0;
                s3.volume = 0;
              } else if (ball2.y < 150) {
                if (!tone) {
                  s1.volume = 0.1;
                s2.volume = 0;
                s3.volume = 0;
                }
              } else {
               
                s1.volume = 0.1;
                s2.volume = 0;
                s3.volume = 0;
              }
              S.update();
            });
          } else {
            errorPane.show();
          }
        }

         //Animated background
         const blob1 = new Blob({
          color: "#F48260",
          interactive: false,
        })
          .center()
          .sca(7)
          .alp(0.2)
          .addTo(scope)
          .animate({
            props: { rotation: "360" },
            time: 7,
            loop: true,
          });
        const blob2 = new Blob({
          color: "#8FA1AA",
          interactive: false,
        })
          .center()
          .sca(8)
          .alp(0.2)
          .addTo(scope)
          .animate({
            props: { rotation: "360" },
            time: 7,
            loop: true,
          });

        const backing = new Circle(
          (scope.width / 2) * 0.95,
          new RadialColor(
            ["white".toAlpha(0.8), "coral".toAlpha(0.5)],
            [0, 1],
            0,
            0,
            (scope.width / 2) * 0.95,
            0,
            0,
            0
          )
        )
          .center(scope)
          .animate({
            props: { alpha: 0.5, scale: 0.94 },
            time: 4,
            loop: true,
            rewind: true,
            ease: "linear",
          });

        const blob = new Blob([
          [-10.4, -172.4, 0, 0, -49.3, 2.7, 49.3, -2.7, "mirror"],
          [205.3, -1, 0, 0, -17, -186.8, 17, 186.8, "mirror"],
          [-1.5, 211.3, 0, 0, 99, 8.2, -99, -8.2],
          [-185.2, -1, 0, 0, -0.7, 139.8, 0.7, -139.8, "mirror"],
        ])
          .sca(5)
          .addTo(scope)
          .center();

        const instruction = new LabelOnPath({
          label: new Label({
            text: "   Tilt   Your  Device ",
            font: "Matrix",
            size: 70,
            color: "#646169",
          }),
          path: blob.center().mov(0, 100),
          showPath: false,
          interactive: false,
        }).center();


        //Tiles for visual effects
        const heartTile = new Circle(
          170,
          new RadialColor(
            ["white", "#7292A6".toAlpha(0.5)],
            [0, 1],
            0,
            0,
            (scope.width / 2) * 0.95,
            0,
            0,
            0
          ),
          clear
        )
          .pos(110, H - 600)
          .cur();
        const barTile = new Circle(
          170,
          new RadialColor(
            ["white", "#7292A6".toAlpha(0.5)],
            [0, 1],
            0,
            0,
            (scope.width / 2) * 0.95,
            0,
            0,
            0
          ),
          clear
        )
          .pos(560, H - 600)
          .cur();
        const circleTile = new Circle(
          170,
          new RadialColor(
            ["white", "#7292A6".toAlpha(0.5)],
            [0, 1],
            0,
            0,
            (scope.width / 2) * 0.95,
            0,
            0,
            0
          ),
          clear
        )
          .pos(1010, H - 600)
          .cur();

        const heartLabel = new Label("Heart", 50, "Matrix", "white").center(
          heartTile
        );
        const barLabel = new Label("Bar", 50, "Matrix", "white").center(
          barTile
        );
        const circleLabel = new Label("Circle", 50, "Matrix", "white").center(
          circleTile
        );

        //createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]);
        //var song = F.asset("3.mp3");
        //var soundInstance = song.play();

        let barSoundWave = new SoundWave(50, tone);
        let barWave;

        let isBarWaveActive = false;

        barTile.on("click", () => {
          if (!isBarWaveActive) {
            synth.wave = barSoundWave;
            startBarWave();
          } else {
            synth.wave = null; 
          }
          isBarWaveActive = !isBarWaveActive;
        });

        function startBarWave() {
          if (barWave) return;

          barWave = new SoundWave(50, tone);
          barWave.on("ready", function () {
            var bars = new Container(scope.width, scope.height)
              .addTo(scope)
              .setMask(backing);
            var width = bars.width;
            var gap = 3;
            loop(barWave.num, function (i, total) {
              var bar = new Rectangle(
                width / total - gap,
                300,
                "coral".toAlpha(0.5)
              );
              bar
                .addTo(bars)
                .mov((i * width) / total, bars.height / 2)
                .reg(0, 150);
            });
            Ticker.add(function () {
              var data = barWave.calculate();
              loop(bars, function (bar, i) {
                bar.heightOnly = data[i] * 300;
              });
            });
          });
        }

        let heartSoundWave = new SoundWave(50, tone);
        let heartWave;
        heartTile.on("click", () => {
          synth.wave = heartSoundWave;
          startheartWave();
        });

        function startheartWave() {
          if (heartWave) return;

          heartWave = new SoundWave(50, tone);
          heartWave.on("ready", function () {
            var hearts = new Container(scope.width, scope.height)
              .addTo(scope)
              .setMask(backing);
            var width = hearts.width;
            var gap = 6;

            var heart = new Shape(-108, -100, 216, 200);
            heart.graphics
              .f("#d9abba")
              .p(
                "AowHHQiRi0jdlRQiekXAHjVQAJkZEuhyQCzhEDJBCQBQAaB0A5QBFAiCZBRQCwh3DRguQDYgwCfAzQD7BRAfDtQANBggcBrQgZBhg0BRQjUFNm4HTQjcDqiwCmQk2ksi4jlg"
              );

            Ticker.add(function () {
              var data = heartWave.calculate();
              // set the height and width of the heart to the associated heartWave data
              // we multiply by 2 to magnify the data a little
              heart.heightOnly = data[0] * 600;
              heart.widthOnly = data[0] * 600;
            });

            // move the heart over a little each time and set the registration point to the bottom
            heart
              .addTo(hearts)
              .mov(width / 2, hearts.height / 2)
              .reg(0, 50);

            Ticker.add(function () {
              var data = heartWave.calculate();
              // set the height and width of the heart to the associated heartWave data
              // multiply by 2 to magnify the data a little
              heart.heightOnly = data[0] * 600;
              heart.widthOnly = data[0] * 600;
            });
          });
        }

        let circleSoundWave = new SoundWave(50, tone);
        let circleWave;
        circleTile.on("click", () => {
          synth.wave = circleSoundWave;
          startCircleWave();
        });

        function startCircleWave() {
          if (circleWave) return;

          circleWave = new SoundWave(50, tone);
          circleWave.on("ready", function () {
            var circles = new Container(scope.width, scope.height)
              .addTo(scope)
              .setMask(backing);
            var width = circles.width;
            var gap = 3;
            // use circleWave.num to tell us how many circles to make
            loop(circleWave.num, function (i, total) {
              // make each circle
              var circle = new Circle(
                45,
                "#86b6db".toAlpha(0.6),
                "#86b6db".toAlpha(0.5)
              );
              // move the circle over a little each time and set the registration point to the bottom
              circle
                .addTo(circles)
                .mov((i * width) / total, circles.height / 2)
                .reg(0, 150);
            });
            Ticker.add(function () {
              var data = circleWave.calculate();
              // loop throught the circles and set the height of the circle to the associated circleWave data
              loop(circles, function (circle, i) {
                circle.heightOnly = data[i] * 600;
              });
            });
          });
        }
        let tone;
        //tiles for different sound effects
        const wahTile = new Rectangle({
          width: 300,
          height: 300,
          color: new RadialColor(
            ["white", "coral".toAlpha(0.5)],
            [0, 1],
            0,
            0,
            (scope.width / 2) * 0.95,
            0,
            0,
            0
          ),
          corner: [10, 50, 10, 50],
        })
          .pos(150, 300)
          .cur();

        const vibratoTile = new Rectangle({
          width: 300,
          height: 300,
          color: new RadialColor(
            ["white", "coral".toAlpha(0.5)],
            [0, 1],
            0,
            0,
            (scope.width / 2) * 0.95,
            0,
            0,
            0
          ),
          corner: [10, 50, 10, 50],
        })
          .pos(600, 300)
          .cur();
        const riserTile = new Rectangle({
          width: 300,
          height: 300,
          color: new RadialColor(
            ["white", "coral".toAlpha(0.5)],
            [0, 1],
            0,
            0,
            (scope.width / 2) * 0.95,
            0,
            0,
            0
          ),
          corner: [10, 50, 10, 50],
        })
          .pos(1050, 300)
          .cur();
        const wahLabel = new Label("Spirit", 50, "Matrix", "white").center(
          wahTile
        );
        const vibratoLabel = new Label("Ghost", 50, "Matrix", "white").center(
          vibratoTile
        );
        const riserLabel = new Label("Riser", 50, "Matrix", "white").center(
          riserTile
        );
        wahTile.on("click", () => {
          tone = synth.tone({
            volume: 50,
            shape: SINE,
            tremeloAmount: 0.2,
            tremeloRate: 12,
            tremeloShape: SINE,
          });

          setTimeout(() => {
            tone.stop();
          }, 2);
        });

        vibratoTile.on("click", () => {
          tone = synth.tone({
            volume: 50,
            note: "C1",
            shape: SQUARE,
            vibratoAmount: 3000,
            vibratoRate: 0.5,
            vibratoThroat: 15,
            vibratoNote: "A1",
            vibratoShape: SINE,
          });

          setTimeout(() => {
            tone.stop();
          }, 2);
        });

        riserTile.on("click", () => {
          riser.play();
        });
        
      } // end ready
    </script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
  </head>
  <body></body>
</html>
